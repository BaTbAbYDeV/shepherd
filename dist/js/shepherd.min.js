"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function isUndefined(e){return"undefined"==typeof e}function isArray(e){return e&&e.constructor===Array}function isObject(e){return e&&e.constructor===Object}function isObjectLoose(e){return"object"==typeof e}function createFromHTML(e){var t=document.createElement("div");return t.innerHTML=e,t.children[0]}function matchesSelector(e,t){var n=void 0;return isUndefined(e.matches)?isUndefined(e.matchesSelector)?isUndefined(e.msMatchesSelector)?isUndefined(e.webkitMatchesSelector)?isUndefined(e.mozMatchesSelector)?isUndefined(e.oMatchesSelector)||(n=e.oMatchesSelector):n=e.mozMatchesSelector:n=e.webkitMatchesSelector:n=e.msMatchesSelector:n=e.matchesSelector:n=e.matches,n.call(e,t)}function parsePosition(e){if(isObjectLoose(e))return e.hasOwnProperty("element")&&e.hasOwnProperty("on")?e:null;var t=positionRe.exec(e);if(!t)return null;var n=t[2];return"["===n[0]&&(n=n.substring(1,n.length-1)),{element:t[1],on:n}}function parseShorthand(e,t){if(null===e||isUndefined(e))return e;if(isObjectLoose(e))return e;for(var n=e.split(" "),i={},s=t.length-1,r=n.length-1;r>=0;r--){if(0===s){i[t[s]]=n.slice(0,r+1).join(" ");break}i[t[s]]=n[r],s--}return i}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function(e,t,n){for(var i=!0;i;){var s=e,r=t,o=n;i=!1,null===s&&(s=Function.prototype);var h=Object.getOwnPropertyDescriptor(s,r);if(void 0!==h){if("value"in h)return h.value;var a=h.get;if(void 0===a)return;return a.call(o)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=r,n=o,i=!0,h=c=void 0}},_Tether$Utils=Tether.Utils,Evented=_Tether$Utils.Evented,addClass=_Tether$Utils.addClass,extend=_Tether$Utils.extend,hasClass=_Tether$Utils.hasClass,removeClass=_Tether$Utils.removeClass,uniqueId=_Tether$Utils.uniqueId,Shepherd=new Evented,ATTACHMENT={top:"bottom center",left:"middle right",right:"middle left",bottom:"top center",center:"middle center"},positionRe=/^(.+) (top|left|right|bottom|center|\[[a-z ]+\])$/,Step=function(e){function t(e,n){return _classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.tour=e,this.bindMethods(),this.setOptions(n),this}return _inherits(t,e),_createClass(t,[{key:"bindMethods",value:function(){var e=this,t=["_show","show","hide","isOpen","cancel","complete","scrollTo","destroy","render"];t.map(function(t){e[t]=e[t].bind(e)})}},{key:"setOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=e,this.destroy(),this.id=this.options.id||this.id||"step-"+uniqueId();var t=this.options.when;if(t)for(var n in t)if({}.hasOwnProperty.call(t,n)){var i=t[n];this.on(n,i,this)}var s=JSON.stringify(this.options.buttons),r=isUndefined(s)||"true"===s,o="{}"===s||"[]"===s||"null"===s||"false"===s,h=!r&&isArray(this.options.buttons),a=!r&&isObject(this.options.buttons);r?this.options.buttons=[{text:"Next",action:this.tour.next,classes:"btn"}]:!o&&a?this.options.buttons=[this.options.buttons]:!o&&h||(this.options.buttons=!1)}},{key:"getTour",value:function(){return this.tour}},{key:"bindAdvance",value:function(){var e=this,t=parseShorthand(this.options.advanceOn,["selector","event","depth"]),n=t.event,i=t.selector,s=t.depth,r=function(t){e.isOpen()&&(isUndefined(i)?e.el&&t.target===e.el&&e.tour.next():matchesSelector(t.target,i)?e.tour.next():isUndefined(s)||matchesSelector(t.target.parentElement,i)&&e.tour.next())},o=document.body;1==this.options.advanceOn.bindDirect&&(o=document.querySelector(i)),o.addEventListener(n,r),this.on("destroy",function(){return o.removeEventListener(n,r)})}},{key:"getAttachTo",value:function(){var e=parsePosition(this.options.attachTo)||{},t=extend({},e);return"string"==typeof e.element&&(t.element=document.querySelector(e.element),t.element||console.error("The element for this Shepherd step was not found "+e.element)),t}},{key:"setupTether",value:function(){if(isUndefined(Tether))throw new Error("Using the attachment feature of Shepherd requires the Tether library");var e=this.getAttachTo(),t=ATTACHMENT[e.on||"right"]||e.on;isUndefined(e.element)&&(e.element="viewport",t="middle center");var n={classPrefix:"shepherd",element:this.el,constraints:[{to:"window",pin:!0,attachment:"together"}],target:e.element,offset:e.offset||"0 0",attachment:t};this.tether&&this.tether.destroy(),this.tether=new Tether(extend(n,this.options.tetherOptions))}},{key:"show",value:function(){var e=this;if(!isUndefined(this.options.beforeShowPromise)){var t=this.options.beforeShowPromise();if(!isUndefined(t))return t.then(function(){return e._show()})}this._show()}},{key:"_show",value:function(){var e=this;this.trigger("before-show"),this.el||this.render(),addClass(this.el,"shepherd-open"),document.body.setAttribute("data-shepherd-step",this.id),this.setupTether(),this.options.scrollTo&&setTimeout(function(){e.scrollTo()}),this.trigger("show")}},{key:"hide",value:function(){this.trigger("before-hide"),removeClass(this.el,"shepherd-open"),document.body.removeAttribute("data-shepherd-step"),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("hide")}},{key:"isOpen",value:function(){return this.el&&hasClass(this.el,"shepherd-open")}},{key:"cancel",value:function(){this.tour.cancel(),this.trigger("cancel")}},{key:"complete",value:function(){this.tour.complete(),this.trigger("complete")}},{key:"scrollTo",value:function(){var e=this.getAttachTo(),t=e.element;isUndefined(this.options.scrollToHandler)?isUndefined(t)||t.scrollIntoView():this.options.scrollToHandler(t)}},{key:"destroy",value:function(){!isUndefined(this.el)&&this.el.parentNode&&(this.el.parentNode.removeChild(this.el),delete this.el),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("destroy")}},{key:"render",value:function(){var e=this;isUndefined(this.el)||this.destroy(),this.el=createFromHTML("<div class='shepherd-step "+(this.options.classes||"")+"' data-id='"+this.id+"' "+(this.options.idAttribute?'id="'+this.options.idAttribute+'"':"")+"></div>");var t=document.createElement("div");t.className="shepherd-content",this.el.appendChild(t);var n=document.createElement("header");if(t.appendChild(n),this.options.title&&(n.innerHTML+="<h3 class='shepherd-title'>"+this.options.title+"</h3>",this.el.className+=" shepherd-has-title"),this.options.showCancelLink){var i=createFromHTML("<a href class='shepherd-cancel-link'>âœ•</a>");n.appendChild(i),this.el.className+=" shepherd-has-cancel-link",this.bindCancelLink(i)}isUndefined(this.options.text)||!function(){var n=createFromHTML("<div class='shepherd-text'></div>"),i=e.options.text;"function"==typeof i&&(i=i.call(e,n)),i instanceof HTMLElement?n.appendChild(i):("string"==typeof i&&(i=[i]),i.map(function(e){n.innerHTML+="<p>"+e+"</p>"})),t.appendChild(n)}(),this.options.buttons&&!function(){var n=document.createElement("footer"),i=createFromHTML("<ul class='shepherd-buttons'></ul>");e.options.buttons.map(function(t){var n=createFromHTML("<li><a class='shepherd-button "+(t.classes||"")+"'>"+t.text+"</a>");i.appendChild(n),e.bindButtonEvents(t,n.querySelector("a"))}),n.appendChild(i),t.appendChild(n)}(),document.body.appendChild(this.el),this.setupTether(),this.options.advanceOn&&this.bindAdvance()}},{key:"bindCancelLink",value:function(e){var t=this;e.addEventListener("click",function(e){e.preventDefault(),t.cancel()})}},{key:"bindButtonEvents",value:function(e,t){var n=this;e.events=e.events||{},isUndefined(e.action)||(e.events.click=e.action);for(var i in e.events)if({}.hasOwnProperty.call(e.events,i)){var s=e.events[i];"string"==typeof s&&!function(){var e=s;s=function(){return n.tour.show(e)}}(),t.addEventListener(i,s)}this.on("destroy",function(){for(var n in e.events)if({}.hasOwnProperty.call(e.events,n)){var i=e.events[n];t.removeEventListener(n,i)}})}}]),t}(Evented),Tour=function(e){function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n),this.bindMethods(),this.options=n,this.steps=this.options.steps||[];var i=["complete","cancel","hide","start","show","active","inactive"];return i.map(function(t){!function(t){e.on(t,function(n){n=n||{},n.tour=e,Shepherd.trigger(t,n)})}(t)}),this}return _inherits(t,e),_createClass(t,[{key:"bindMethods",value:function(){var e=this,t=["next","back","cancel","complete","hide"];t.map(function(t){e[t]=e[t].bind(e)})}},{key:"addStep",value:function(e,t){return isUndefined(t)&&(t=e),t instanceof Step?t.tour=this:("string"!=typeof e&&"number"!=typeof e||(t.id=e.toString()),t=extend({},this.options.defaults,t),t=new Step(this,t)),this.steps.push(t),this}},{key:"removeStep",value:function(e){for(var t=this.getCurrentStep(),n=0;n<this.steps.length;++n){var i=this.steps[n];if(i.id===e){i.hide(),i.destroy(),this.steps.splice(n,1);break}}t&&t.id===e&&(this.currentStep=void 0,this.steps.length?this.show(0):this.hide())}},{key:"getById",value:function(e){for(var t=0;t<this.steps.length;++t){var n=this.steps[t];if(n.id===e)return n}}},{key:"getCurrentStep",value:function(){return this.currentStep}},{key:"next",value:function(){var e=this.steps.indexOf(this.currentStep);e===this.steps.length-1?(this.hide(e),this.trigger("complete"),this.done()):this.show(e+1,!0)}},{key:"back",value:function(){var e=this.steps.indexOf(this.currentStep);this.show(e-1,!1)}},{key:"cancel",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("cancel"),this.done()}},{key:"complete",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("complete"),this.done()}},{key:"hide",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("hide"),this.done()}},{key:"done",value:function(){Shepherd.activeTour=null,removeClass(document.body,"shepherd-active"),this.trigger("inactive",{tour:this})}},{key:"show",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];this.currentStep?this.currentStep.hide():(addClass(document.body,"shepherd-active"),this.trigger("active",{tour:this})),Shepherd.activeTour=this;var n=void 0;if(n="string"==typeof e?this.getById(e):this.steps[e])if(isUndefined(n.options.showOn)||n.options.showOn())this.trigger("show",{step:n,previous:this.currentStep}),this.currentStep&&this.currentStep.hide(),this.currentStep=n,n.show();else{var i=this.steps.indexOf(n),s=t?i+1:i-1;this.show(s,t)}}},{key:"start",value:function(){this.trigger("start"),this.currentStep=null,this.next()}}]),t}(Evented);extend(Shepherd,{Tour:Tour,Step:Step,Evented:Evented});